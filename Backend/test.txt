import logo from './logo.svg';
import './App.css';
import Main from './Main';
function App() {
  return (
    <>
        <Main/>
    </>
  );
}

export default App;



Main.js




import React, { useState, useEffect } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { Navigate } from 'react-router-dom';
import WelcomePage from './WelcomePage';
import Signin from './Componants/Signin';
import Signup from './Componants/Signup';
import Dashboard from './Componants/Dashboard';
import ForgotPass from './Componants/ForgotPass';
import ProtectedRoute from './Componants/ProtectedRoute';
import ChangePass from './Componants/ChangePass';
import SecondPage from './Componants/SecondPage';
import OtpPage from './Componants/OtpPage';
import {Toaster} from 'react-hot-toast'
import ProtectedOtp from './Componants/ProtectedOtp';
import ProtectedPass from './Componants/ProtectedPass';
function Main() {
  const [bool, setBool] = useState(true);

  useEffect(() => {
    const timer = setTimeout(() => setBool(false), 2000);
    return () => clearTimeout(timer);
  }, []);
  
//   const isStepAllowed = () => {
//     // if (step == "forgot") return true;
//     if (localStorage.getItem("tempEmail")) return true;
//     if (localStorage.getItem("resetEmail")) return true;
//     return false;
//   };

  return (
    <BrowserRouter>
      <Routes>
        {bool ? (
          <Route path="/" element={<WelcomePage />} />
        ) : (
          <>
            <Route path="/" element={<SecondPage/>} />
            <Route path="/signin" element={<Signin/>} />
            <Route path="/signup" element={<Signup/>} />
            <Route path="/forgot" element={<ForgotPass/>} />
            <Route path="/dashboard" element={<ProtectedRoute><Dashboard /></ProtectedRoute>} />
            <Route path='/passchange' element={<ProtectedPass><ChangePass/></ProtectedPass>}/>
            {/* <Route
              path="/passchange"
              element={
                isStepAllowed() ? <ChangePass /> : <Navigate to="/signin" />
              }
            /> */}
            <Route path='/varifyotp' element={<ProtectedOtp><OtpPage/></ProtectedOtp>}/>
            {/* <Route
              path="/varifyotp"
              element={
                isStepAllowed() ? <OtpPage /> : <Navigate to="/signin" />
              }
            /> */}
          </>
        )}
      </Routes>
      <Toaster />
    </BrowserRouter>
    
  );
}

export default Main;


ProtectedOtp.js
import React, { Children } from 'react';
import { Navigate } from 'react-router-dom';
function ProtectedOtp({children}){
    const tempEmail=localStorage.getItem('tempEmail');
    if(!tempEmail){
        return <Navigate to='/signin' replace />
    }
    return children
}
export default ProtectedOtp;


ProtectedPass.js
import React from 'react';
import { Navigate } from 'react-router-dom';
function ProtectedPass({children}){
    const resetEmail=localStorage.getItem('resetEmail');
    if(!resetEmail){
        return <Navigate to='/signin' replace />
    }
    return children
}
export default ProtectedPass;



SecondPage.js
import React from 'react';
import wallpaper from '../images/wallpaper.jpg'
import { useNavigate,Link } from 'react-router-dom';
import './componant_css.css';
function SecondPage(){
    const navigate=useNavigate();
    const handleClickEmail=()=>{
        navigate('/Signin')
    }
    return(
    <>
            <div style={{margin:'0px',marginRight:'15px'}}>
                <div style={{marginLeft:'7px',marginRight:'15px',}}>
                    <div style={{marginTop:'10px'}}>
                        <img src={wallpaper} style={{borderRadius:'50%',height:'100px',width:'100px'}}/>
                        <br/>
                        <div style={{marginTop:'3px',marginBottom:'10px'}}>
                            <p style={{paddingLeft:'10px',color:'black',marginTop:'0px',marginBottom:'0px'}}>welcome to</p>
                            <h1 style={{paddingLeft:'10px',color:'black',marginTop:'0px',marginBottom:'0px'}}>Linear</h1>
                            <p style={{paddingLeft:'10px',color:'black',marginTop:'0px',paddingTop:'0px ',fontSize:'15px'}}>A place where you can track all yout <p style={{display:'clock',marginTop:'0px',paddingTop:'0px'}}>expness and income</p></p>
                        </div>
                        <div style={{marginTop:'3px',marginBottom:'10px',paddingRight:'40px'}}>
                            <p style={{paddingLeft:'10px',color:'black',marginTop:'0px'}}>Let's get started</p>
                            <button style={{paddingLeft:'10px',color:'black',marginTop:'0px',width:'100%',marginLeft:'25px',marginRight:'20px',borderRadius:'10px',height:'50px',textDecoration:'none',backgroundColor:'white'}}><a href="google.com">google</a></button>
                            <button style={{paddingLeft:'10px',color:'black',marginTop:'0px',width:'100%',marginLeft:'25px',marginRight:'20px',marginTop:'6px',borderRadius:'10px',height:'50px',backgroundColor:'white'}} onClick={handleClickEmail}>continue with email</button>
                            <p style={{color:'black',marginTop:'0px',marginLeft:'25px',paddingTop:'3px ',justifyContent:'center',justifyItems:'center',textAlign:'center',fontSize:'10px'}}>already have an account? <Link to='/Signin'>Signin</Link></p>
                        </div>
                    </div>
                </div>
            </div>
    </>
    )
}
export default SecondPage;


WelcomePage.js
import React from 'react';
function WelcomePage(){
    return(
        <>
            <h1 style={{textAlign:'center',color:'red'}}>Welcome TechMobile</h1>
        </>
    )
}
export default WelcomePage;


Signup.js

import React, { useState } from 'react';
import { useNavigate,Link } from 'react-router-dom';
import axios from 'axios';
import Navbar from './Navbar';
import facebook from '../images/facebook.webp'
import google from '../images/google.webp'
function Signup() {
  const [fdata, setFdata]=useState({ 
    name:'',
    number:'',
    email:'', 
    password:''
});
  const navigate = useNavigate();
  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      const res = await axios.post("https://authentication-figma.onrender.com/signup", fdata);
      if (res.data.status == "ok") {
        alert(res.data.message);
        navigate("/signin");
      } else {
        alert(res.data.message);
      }
    } catch (error) {
      console.log(error);
      alert("Error submitting data");
    }
  };
  return (
    <>
    {/* <Navbar/> */}
    <div style={{display:'flex',paddingLeft:'10px',marginLeft:'7px',marginRight:'10px',marginTop:'50px',justifyContent:'center'}}>
      
      <div style={{ textAlign: 'center',width: '100%',maxWidth: '420px', }}>

        <h1 style={{marginBottom:'4px',color:'blue',marginTop:'4px'}}>Sign Up</h1>

        <div style={{display:'flex',justifyContent:'center',marginLeft:'20px',marginRight:'20px'}}>
          <p style={{marginTop:'0px',marginBottom:'5px',textAlign:'center',}}>it was popularised in 1960 with the release of Letraset sheetscontaining Lorem ipsum</p>
        </div>

        {/* button field */}
       <div style={{display:"flex",width:'100%',alignItems:'center',marginTop:'2px',marginBottom:'0px'}}>
                <button style={{padding:'12px',borderRadius:'10px',width:'50%',marginRight:'10px',backgroundColor:'white',border: '1px solid lightgray'}}>Facebook</button>
                <button style={{padding:'12px',borderRadius:'10px',width:'50%',backgroundColor:'white',border: '1px solid lightgray'}} >Google</button>
        </div>

        <div style={{display:"flex",width:'100%',alignItems:'center',marginTop:'10px',}}>
                  <hr style={{width:'35%'}}/>
                  <p style={{margin:'0px 5px'}}>or</p>
                  <hr style={{width:'35%'}}/>   
                  {/* <hr style={{padding:'15px',borderRadius:'10px',textAlign:'center',alignItems:'center'}} /> */}
          </div>
        
        <form onSubmit={handleSubmit} style={{marginTop:'0px'}}>
          <input type="text" placeholder="Name" required onChange={(e)=>setFdata({ ...fdata, name:e.target.value })}
           style={{padding:'10px',borderRadius:'10px',width:'100%',marginTop:'10px',border:'none',backgroundColor:'whitesmoke',marginRight:'10px'}}/>
           <br />
          <input type="number" placeholder="Number" required onChange={(e)=>setFdata({ ...fdata, number:e.target.value })} 
            style={{padding:'10px',borderRadius:'10px',width:'100%',marginTop:'10px',border:'none',backgroundColor:'whitesmoke',marginRight:'10px'}}/>
          <br />
          <input type="email" placeholder="Email" required onChange={(e)=>setFdata({ ...fdata, email:e.target.value })} 
          style={{padding:'10px',borderRadius:'10px',width:'100%',marginTop:'10px',border:'none',backgroundColor:'whitesmoke',marginRight:'10px'}}/>
          <br />
          <input type="password" placeholder="Password" required onChange={(e)=>setFdata({ ...fdata, password:e.target.value })}
          style={{padding:'10px',borderRadius:'10px',width:'100%',marginTop:'10px',border:'none',backgroundColor:'whitesmoke',marginRight:'10px'}} />
          <br />
          <div style={{display:'flex',justifyContent:'center',marginLeft:'20px',marginRight:'20px'}}>
            <input type='checkbox' name='checkbox'/><p style={{fontSize:'12px',textAlign:'center'}}>i am agree to Terms of service and privet policy</p>
          </div>
          <input type="submit" value="Create Account" style={{padding:'10px',borderRadius:'10px',width:'100%',marginTop:'10px',backgroundColor:'blue',color:'white',marginRight:'10px'}}/>
        </form>
        <p style={{marginTop:'2px'}}>Do you have an Account? <Link to='/Signin'>Signin</Link></p>
      </div>
    </div>
    </>
  );
}
export default Signup;





Signin.js
import React, { useState } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import Navbar from './Navbar';
import axios from 'axios';
function Signin() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const navigate = useNavigate();
  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      const res = await axios.post("https://authentication-figma.onrender.com/signin", { email, password });
      if (res.data.status!== "ok") {
        alert(res.data.message);
        return;
      }
      localStorage.setItem("token", res.data.token);
      alert(res.data.message);
      navigate("/dashboard");
    } catch (error) {
      console.log(error);
      alert("Server error");
    }
  };
  return (
    <>
    {/* <Navbar/> */}

<div style={{display:'flex',paddingLeft:'10px',marginLeft:'7px',marginRight:'10px',marginTop:'50px',justifyContent:'center'}}>
    <div style={{ textAlign: 'center',width: '100%',maxWidth: '420px'}}>
        <h1 style={{marginBottom:'4px',color:'blue',marginTop:'4px'}}>Sign In</h1>

          <div style={{display:'flex',justifyContent:'center',marginLeft:'20px',marginRight:'20px'}}>
            <p style={{marginTop:'0px',marginBottom:'5px',textAlign:'center',}}>it was popularised in 1960 with the release of Letraset sheetscontaining Lorem ipsum</p>
          </div>

          {/* button field */}
        <div style={{display:"flex",width:'100%',alignItems:'center',marginTop:'2px',marginBottom:'0px'}}>
                  <button style={{padding:'12px',borderRadius:'10px',width:'50%',marginRight:'10px',backgroundColor:'white',border: '1px solid lightgray'}} >Facebook</button>
                  <button style={{padding:'12px',borderRadius:'10px',width:'50%',backgroundColor:'white',border: '1px solid lightgray'}} >Google</button>
          </div>

          <div style={{display:"flex",width:'100%',alignItems:'center',marginTop:'10px',}}>
                  <hr style={{width:'35%'}}/>
                  <p style={{margin:'0px 5px'}}>or</p>
                  <hr style={{width:'35%'}}/>   
                  {/* <hr style={{padding:'15px',borderRadius:'10px',textAlign:'center',alignItems:'center'}} /> */}
          </div>
        <form onSubmit={handleSubmit}>
          <input type="email" placeholder="Email" value={email} onChange={e => setEmail(e.target.value)} required 
          style={{padding:'10px',borderRadius:'10px',width:'100%',marginTop:'10px',border:'none',backgroundColor:'whitesmoke',marginRight:'10px'}}/>
          <br />
          <input type="password" placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} required 
          style={{padding:'10px',borderRadius:'10px',width:'100%',marginTop:'10px',border:'none',backgroundColor:'whitesmoke',marginRight:'10px'}}/>
          <br />
          <p><Link to='/forgot'>forgot password</Link></p>
          <input type="submit" value="Login" style={{padding:'10px',borderRadius:'10px',width:'100%',marginTop:'10px',backgroundColor:'blue',color:'white',marginRight:'10px'}} /><br />
        </form>
        <p style={{marginTop:'10px'}}>Do you have an Account? <Link to="/signup">Signup</Link></p>
      </div>
    </div> 

    </>
  );
}

export default Signin;


ForgotPass.js
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import axios from 'axios';
import {ArrowLeft} from 'lucide-react';
import toast from 'react-hot-toast';
function ForgotPass() {
    const [email, setEmail]=useState('');
    // const[showOtp,setShowOtp]=useState(false);
    // const[otp,setOtp]=useState('');
    // const[send,setSend]=useState(false);
    // const[sub,setSub]=useState(false);

    const navigate = useNavigate();
    const handleSend = async (e) => {
        e.preventDefault();
        try {
          const res = await axios.post("https://authentication-figma.onrender.com/forgot", {email});
          if (res.data.status == "ok") {
            toast.success(res.data.message)
            localStorage.setItem('tempEmail',email);
            navigate('/varifyotp');
        }
        else{
          toast.error('email not found')
        }
    } catch (error) {
      console.log(error);
      toast.error("Error updating password");
    }
  }
    const handleClickBack=()=>{
        navigate('/signin')
    }

    return (
      <>
      <div style={{marginBottom:'0px'}}>
        <button style={{marginLeft:'5px',marginTop:'40px',border:'none',backgroundColor:'white',paddingBottom:'0px'}} onClick={handleClickBack}> <ArrowLeft></ArrowLeft> </button>
          <div style={{display:'flex',paddingLeft:'10px',marginLeft:'7px',marginRight:'7px',marginTop:'50px',justifyContent:'center',paddingRight:'10px'}}>
            <div style={{ textAlign: 'center',width: '100%',maxWidth: '420px', }}>
                <h1 style={{marginBottom:'4px',color:'blue',marginTop:'4px'}}>Forgot Password</h1>
                <div style={{display:'flex',justifyContent:'center',marginLeft:'20px',marginRight:'20px'}}>
                  <p style={{marginTop:'0px',marginBottom:'5px',textAlign:'center',color:'gray'}}>it was popularised in 1960 with the release of Letraset sheetscontaining Lorem ipsum</p>
                </div>
                  <form onSubmit={handleSend}>
                      <input type="email" placeholder="Email" value={email} onChange={e => setEmail(e.target.value)} required 
                      style={{padding:'15px',borderRadius:'10px',width:'90%',marginTop:'10px',border:'none',backgroundColor:'whitesmoke',marginRight:'10px'}}/>
                      <br />
                        <input type="submit" value="Send Mail" style={{padding:'15px',borderRadius:'10px',width:'100%',marginTop:'20px',backgroundColor:'blue',color:'white',cursor:'pointer',fontSize:'16px'}} />
                  </form>
            </div>
          </div>
      </div>
        </>
  );
}
export default ForgotPass;





ChangePass.js
import React ,{useState}from 'react';
import axios from 'axios';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import toast from 'react-hot-toast';
function ChangePass(){
    const[password,setPassword]=useState('');
    const[confirmPass,setConfirmPass]=useState('');
    const navigate=useNavigate();
    const email=localStorage.getItem('resetEmail');
    const handleChange=async(e)=>{
        e.preventDefault();
        if (password !== confirmPass) {
            return toast.error("Password and Confirm Password do not match!");
        }
        const res=await axios.post('https://authentication-figma.onrender.com/passchange',{
            email,password,
        });
        if (res.data.status === "ok") {
            toast.success("Password changed successfully");
            localStorage.removeItem("tempEmail");
            localStorage.removeItem("resetEmail");
            navigate("/signin");
        } 
        if(res.data.status === "error"){
            toast.error(res.data.error)
        }
        else {
            toast.error("Error changing password");
        }
    }
    const handleClickBack=()=>{
        navigate('/varifyotp')
    }
    return(
        <>
            <div>
                <button style={{marginLeft:'5px',marginTop:'40px',border:'none',backgroundColor:'white'}} onClick={handleClickBack}> <ArrowLeft></ArrowLeft> </button>
                <div style={{display:'flex',paddingLeft:'10px',marginLeft:'7px',marginRight:'7px',marginTop:'50px',justifyContent:'center',paddingRight:'10px'}}>
                    <div style={{ textAlign: 'center',width: '100%',maxWidth: '420px'}}>
                        <h1 style={{marginBottom:'4px',color:'blue',marginTop:'4px'}}>Change Password</h1>
                        <div style={{display:'flex',justifyContent:'center',marginLeft:'20px',marginRight:'20px'}}>
                            <p style={{marginTop:'0px',marginBottom:'5px',textAlign:'center',color:'gray'}}>it was popularised in 1960 with the release of Letraset sheetscontaining Lorem ipsum</p>
                        </div>
                        <form onSubmit={handleChange}>
                            <input type="password" placeholder="New Password" onChange={(e) => setPassword(e.target.value)} required
                            style={{padding:'13px',borderRadius:'10px',width:'90%',marginTop:'10px',border:'none',backgroundColor:'whitesmoke',marginRight:'10px'}} />
                            <br />
                            <input type="password" placeholder="Confirm Password" onChange={(e) => setConfirmPass(e.target.value)} required
                            style={{padding:'13px',borderRadius:'10px',width:'90%',marginTop:'10px',border:'none',backgroundColor:'whitesmoke',marginRight:'10px'}}/>
                            <br />
                            <button type="submit" style={{padding:'13px',borderRadius:'10px',width:'100%',marginTop:'10px',backgroundColor:'blue',color:'white',marginRight:'10px'}} >Update Password</button>
                        </form>
                    </div>
                </div>
            </div>
        </>
    )
}
export default ChangePass

ProtectedRoute.js
import React, { useEffect, useState } from 'react';
import { Navigate } from 'react-router-dom';
import axios from 'axios';

function ProtectedRoute({ children }) {
  const [loading, setLoading] = useState(true);
  const [allowed, setAllowed] = useState(false);

  useEffect(() => {
    const check = async () => {
      const token = localStorage.getItem("token");
      if (!token) { setAllowed(false); setLoading(false); return; }
      try {
        const res = await axios.get("https://authentication-figma.onrender.com/dashboard", {headers:{ Authorization: localStorage.getItem("token") }});
        if (res.data.status === "ok"){
           setAllowed(true);
      }
      }
      catch (error) {
        setAllowed(false);
      }
      finally {
        setLoading(false);
      }
    };
    check();
  }, []);
  if (loading) return <div style={{textAlign:'center'}}>Checking........</div>;
  if (!allowed) return <Navigate to="/signin" replace />;
  return children;
}
export default ProtectedRoute;



Dashboard.js
import React from 'react';
import { useNavigate } from 'react-router-dom';
function Dashboard() {
  const navigate = useNavigate();
  const logout = () => {
    localStorage.removeItem("token");
    navigate("/signin");
  };
  return (
    <div style={{ textAlign: 'center' }}>
      <h1>Dashboard Page</h1>
      <button onClick={logout}>Logout</button>
    </div>
  );
}
export default Dashboard;


OtpPage.js
import React,{useEffect, useState} from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import axios from 'axios';
import toast from 'react-hot-toast';
function OtpPage(){
    const[otp,setOtp]=useState('      ');
    const navigate=useNavigate();
    const emails=localStorage.getItem('tempEmail');
    // useEffect(()=>{
    //     if(email){
    //         axios.post("https://authentication-figma.onrender.com/resendotp",{email});
    //     }
    // },[email])
    const handleVarify=async(e)=>{
        e.preventDefault();
       try{
            const res=await axios.post("https://authentication-figma.onrender.com/varifyotp",{
            otp,
            email:emails
        })
        if(res.data.status=='ok'){
            toast.success('otp vaArified')
            localStorage.setItem('resetEmail',emails)
            navigate('/passchange');
        }
        else if(res.data.status=='wrong'){
            toast.error('invalid otpp')
        }
        else{
            toast.error('email not found');
        }
       }
       catch(error){
        toast.error('error in varify otp...')
       }
    }

    const handleClickBack=()=>{
        navigate('/forgot')
    }

    const handleResend=async()=>{
        try{
            
            var res=await axios.post("https://authentication-figma.onrender.com/resendotp",{
                email:emails
            });
            if(res.data.status=='ok'){
                alert('resend otp in mailll')
            }
        }
        catch(error){
        }
    }
    return(
        <>
              <div style={{marginBottom:'0px'}}>
                <button style={{marginLeft:'5px',marginTop:'40px',border:'none',backgroundColor:'white',paddingBottom:'0px'}} onClick={handleClickBack}> <ArrowLeft></ArrowLeft> </button>
                  <div style={{display:'flex',paddingLeft:'10px',marginLeft:'7px',marginRight:'7px',marginTop:'50px',justifyContent:'center',paddingRight:'10px'}}>
                    <div style={{ textAlign: 'center',width: '100%',maxWidth: '420px', }}>
                        <h1 style={{marginBottom:'4px',color:'blue',marginTop:'4px'}}>Enter OTP</h1>
                        <div style={{display:'flex',justifyContent:'center',marginLeft:'20px',marginRight:'20px'}}>
                          <p style={{marginTop:'0px',marginBottom:'5px',textAlign:'center',color:'gray'}}>Enter the otp code we just sent you on your registered Email</p>
                        </div>
                          <form onSubmit={handleVarify}>
                            <div style={{ display: "flex", justifyContent: "center", gap: "12px", marginTop: "20px" }}>
                                {[0,1,2,3,4,5].map((i) => (
                                    <input
                                    key={i}
                                    maxLength={1}
                                    onChange={(e) => {
                                        const value = e.target.value.replace(/\D/g, "");
                                        let newOtp = otp.split("");

                                        newOtp[i] = value;
                                        setOtp(newOtp.join(""));

                                        // Move to next box automatically
                                        if (value && i < 5) {
                                        document.getElementById(`otp-${i+1}`).focus();
                                        }
                                    }}
                                    id={`otp-${i}`}
                                    style={{
                                        width: "30px",
                                        height: "50px",
                                        borderRadius: "10px",
                                        border: "1px solid lightgray",
                                        textAlign: "center",
                                        fontSize: "10px",
                                        backgroundColor: "#f3f6fb"
                                    }}
                                    />
                                ))}
                                </div>
                                <br/>
                              <br/>
                              <input type='submit' value='Confirm Otp' style={{padding:'13px',borderRadius:'10px',width:'100%',marginTop:'0px',backgroundColor:'blue',color:'white',marginRight:'10px'}} />
                          </form>
                          <p style={{marginTop:'8px',paddingLeft:'8px',justifyContent:'left','textAlign':'left'}}>Did'n get otp? <button onClick={handleResend} style={{backgroundColor:'white',border:'none',color:'blue',paddingLeft:'0px'}}>resend otp</button></p>
                          
                        </div>
                    </div>
                 </div>
            </>
    )
}
export default OtpPage;


Backend 
Server.js
const express = require('express');
const app = express();
require("dotenv").config(); 
const cors = require('cors');
const bodyparser = require('body-parser');
const mg = require('mongoose');
const jwt = require('jsonwebtoken');
const nodemailer=require('nodemailer')
app.use(cors());
app.use(express.json());
app.use(bodyparser.urlencoded({ extended: true }));

mg.connect(process.env.MONGO_URL)
  .then(() => console.log('MongoDB connected successfully'))
  .catch((error) => console.log('MongoDB connection error:', error));

const schema = new mg.Schema({
  name: String,
  email:String ,
  number: Number,
  password: String,
  otp: Number,          
  otpExpire: Date ,
});

const figmaData = mg.model('figmaData', schema);
const Jwt_key = process.env.JWT_KEY;

app.post('/signup', async (req, res) => {
  try {
    const {name,number,email,password } = req.body;

    if (!email || !password){
      return res.json({ status: "error", message: "Email and password required" });
    }
    if(!(password.length > 5 && /[A-Z]/.test(password) && /[a-z]/.test(password) && /[^A-Za-z0-9]/.test(password))){
      return res.json({ status: "error", message: "Password must contain uppercase, lowercase, symbol and minimum length 6" })
    }
    const exists = await figmaData.findOne({ email });
    if (exists) return res.json({message:"Email exists"});
    const user = new figmaData({name,number,email,password });
    await user.save();
    const token = jwt.sign({id: user._id, email: user.email }, Jwt_key,{expiresIn:'1Y'});
    res.json({ status:"ok", message:"Signup successful",token });
  } catch (error) {
    console.log(error);
    res.json({status:"error",message:"Error submitting data" });
  }
});

app.post('/signin', async (req, res) => {
  try {
    const { email, password } = req.body;
    const user = await figmaData.findOne({ email });
    if (!user) return res.json({message: "Email not found" });

    if (user.password != password) {
      return res.json({ status: "error", message: "Invalid password" });
    }
    const token = jwt.sign({ id: user._id, email: user.email }, Jwt_key,{expiresIn:'1Y'});
    return res.json({status:'ok',message:"Login successful",token });
  } catch (error) {
    console.log(error);
    return res.json({message: "signin error" });
  }
});

app.get('/dashboard', (req, res) => {
  const token = req.headers['authorization'];
  if (!token) {
    return res.json({ status: "error", message: "Access Denied" });
  }
  try {
    const decoded = jwt.verify(token, Jwt_key);
    res.json({ status: "ok", message: "Dashboard Data", userId: decoded.id });
  } catch (err) {
    res.json({ status: "error", message: "Invalid Token" });
  }
});

const transporter = nodemailer.createTransport({
  host: "smtp.gmail.com",
  port: 587,
  secure: false, 
  auth: {
    user: process.env.MAIL_USER,         
    pass: process.env.MAIL_PASS,      
  },
});

app.post("/forgot", async (req, res) => {
  try {
    const {email} = req.body;
    const user = await figmaData.findOne({email});
    if (!user) {
      return res.json({status:'error',message:"Email not found" });
    }
    // res.json({status:'ok',message:'email varifid success'})
    const otp = Math.floor(100000 + Math.random() * 900000).toString();
    user.otp = otp;
    await user.save();

    const mailOptions = {
      from: process.env.MAIL_USER,
      to: email,
      subject: "Your OTP Code",
      text: `Your OTP is: ${otp}.`,
    };

    transporter.sendMail(mailOptions, (error, info) => {
      if (error) {
        console.log('mail error:',error);
        return res.json({ status: "error", message: "Email sending failed" });
      }
    });
    return res.json({ status: "ok", message: "OTP sent to your email" });

  } catch (error) {
    console.log(error);
    res.json({message: "Error updating password" });
  }
});

app.post('/varifyotp',async(req,res)=>{
  try{
      const {otp,email}=req.body;
      const user=await figmaData.findOne({email})
      if (!user) {
        return res.json({message:"Email not found" });
      }
      // const otpw = Math.floor(100000 + Math.random() * 900000).toString();
      

    // const mailOptions = {
    //   from: "prathamcd003@gmail.com",
    //   to: email,
    //   subject: "Your OTP Code",
    //   text: `Your OTP is: ${otp}.`,
    // };

    // transporter.sendMail(mailOptions, (error, info) => {
    //   if (error) {
    //     console.log(error);
    //     return res.json({ status: "error", message: "Email sending failed" });
    //   }
    // });
    // res.json({ status: "ok", message: "OTP sent to your email" });

    if ((user.otp).toString() !== otp) {
      return res.json({ status:'wrong',message: "otp not validd" });
    }
    user.otp = '';
    await user.save();
    return res.json({status:"ok", message:'OTP verified'});
  }
  catch(error){
    res.json({message:'error in varify otp'})
  }
})

app.post('/resendotp',async(req,res)=>{
  try{
    const {email}=req.body;
    const user=await figmaData.findOne({email});
    const otp=Math.floor(100000+Math.random()*900000).toString();
    user.otp=otp
    await user.save();
    const mailOptions = {
      from: "prathamcd003@gmail.com",
      to: email,
      subject: "Your OTP Code",
      text: `Your OTP is: ${otp}.`,
    };

    transporter.sendMail(mailOptions, (error, info) => {
      if (error) {
        console.log(error);
        return res.json({ status: "error", message: "Email sending failed" });
      }
    });
    res.json({ status: "ok", message: "otp resend" });

  }
  catch(error){

  }
})

app.post('/passchange',async(req,res)=>{
  try{
    const {email,password} = req.body;
    const user=await figmaData.findOne({email});
    if(!user){
      return res.json({message:"Email not found" });
    }
    user.password = password;
    user.otp = null;
    await user.save();
    return res.json({ status: "ok", message: "Password updated successfully" });
  }
  catch(error){
    res.json({message:'error in changig password'})
  }
})
app.listen(1290, () => {
  console.log('Backend running on port 1290');
});
